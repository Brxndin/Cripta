<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Cripta</title>
        <style>
            body {
                background-color: #520a06;
            }

            #p {
                background-color: #368203;
            }

            .i {
                background-color: red;
            }

            .zumbi {
                background-color: lightgreen;
            }

            .o {
                background-color: brown;
            }

            .ar {
                background-color: gray;
                border: 1px solid black;
            }

            .po {
                background-color: #b0279b;
            }

            .it {
                border: 1px solid black;
                background-color: yellow;
            }

            #mapa {
                background-color: #e8b07b;
            }

            .menu {
                display: none;
                z-index: 99;
                background-color: #520a06;
                color: white;
                position: absolute;
                width: 500px;
                height: 500px;
                border: 2px solid white;
                left: 650px;
                top: 300px;
                padding: 20px;
                /*
              overflow-y: scroll;
              */
            }

            .botao {
                width: 150px;
                height: 50px;
                border: 1px solid white;
                color: white;
                background-color: #520a06;
            }

            .titulo {
                color: white;
            }
        </style>
    </head>
    <body>
        <div id="inicial" style="text-align: center">
            <h1 class="titulo">Cripta</h1>
            <button class="botao" id="novo">Novo Jogo</button>
        </div>
        <div id="div_inv" class="menu">
            <h1>Inventário</h1>
            <div id="div_inv_content"></div>
        </div>
        <div id="div_equip" class="menu">
            <h1>Status</h1>
            <div id="status"></div>
            <h1>Equipamento</h1>
            <div id="div_equip_content"></div>
        </div>
        <div id="canvas"></div>

        <script>
            // gera um numero inteiro pseudoaleatorio
            function randint(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max + 1);

                return Math.floor(Math.random() * (max - min)) + min;
            }

            //retorna true ou false de acordo com a chance em porcentagem informada
            //exemplo: perc(50) tem 50% de chance de retornar true
            function perc(n) {
                return randint(1, 100) <= n;
            }

            c = document.getElementById('canvas');

            function criarTag(obj) {
                var tag = document.createElement(obj.tipo);
                tag.style.position = 'absolute';

                for (const i in obj) {
                    if (i == 'style') {
                        for (const j in obj[i]) {
                            tag.style[j] = obj[i][j];
                        }
                    } else if (i == 'attributes') {
                        for (const j in obj[i]) {
                            tag.setAttribute(j, obj[i][j]);
                        }
                    } else if (i != 'tipo') {
                        tag[i] = obj[i];
                    }
                }

                return tag;
            }

            var listaMapas = {
                0: {
                    x: Math.round(screen.width / 4),
                    y: Math.round(screen.height / 7),
                    altura: Math.round(screen.height * (55.5 / 100)),
                    largura: Math.round(screen.width * (50 / 100)),
                    func: function () {
                        if (perc(33)) {
                            criarObstaculo(Math.round(this.x + this.largura / 2 - 40), Math.round(this.y + this.altura / 2 - 40), 80, 80);
                        } else if (perc(33)) {
                            criarObstaculo(this.x, 550, 500, 50);
                            criarObstaculo(this.x + this.largura - 500, 300, 500, 50);
                        }
                    },
                },
                1: {
                    x: Math.round(screen.width / 2 - (screen.width * (20 / 100)) / 2),
                    y: Math.round(screen.height / 7),
                    altura: Math.round(screen.height * (55.5 / 100)),
                    largura: Math.round(screen.width * (20 / 100)),
                    func: function () {
                        if (perc(50)) {
                            criarObstaculo(Math.round(this.x + this.largura / 2 - 40), Math.round(this.y + this.altura / 2 - 40), 80, 80);
                        }
                    },
                },
            };

            var listaPortais = {
                //esquerda
                1: {
                    id: 'po1',
                    largura: 30,
                    altura: 90,
                    func: () => {
                        criarObstaculo(mapa.x, mapa.y + Math.floor(mapa.altura / 2) - 45 - 30, 40, 30);
                        criarObstaculo(mapa.x, mapa.y + Math.floor(mapa.altura / 2) - 45 + 90, 40, 30);
                    },
                },
                //direita
                2: {
                    id: 'po2',
                    largura: 30,
                    altura: 90,
                    func: () => {
                        criarObstaculo(mapa.x + mapa.largura - 40, mapa.y + Math.floor(mapa.altura / 2) - 45 - 30, 40, 30);
                        criarObstaculo(mapa.x + mapa.largura - 40, mapa.y + Math.floor(mapa.altura / 2) - 45 + 90, 40, 30);
                    },
                },
                //cima
                3: {
                    id: 'po3',
                    largura: 90,
                    altura: 30,
                    func: () => {
                        criarObstaculo(mapa.x + Math.floor(mapa.largura / 2) - 45 - 30, mapa.y, 30, 40);
                        criarObstaculo(mapa.x + Math.floor(mapa.largura / 2) - 45 + 90, mapa.y, 30, 40);
                    },
                },
                //baixo
                4: {
                    id: 'po4',
                    largura: 90,
                    altura: 30,
                    func: () => {
                        criarObstaculo(mapa.x + Math.floor(mapa.largura / 2) - 45 - 30, mapa.y + mapa.altura - 40, 30, 40);
                        criarObstaculo(mapa.x + Math.floor(mapa.largura / 2) - 45 + 90, mapa.y + mapa.altura - 40, 30, 40);
                    },
                },
            };

            var mapa = {};

            var portais = {};

            function criarPortais(n) {
                listaPortais['1'].x = mapa.x;
                listaPortais['1'].y = mapa.y + Math.floor(mapa.altura / 2) - 45;

                listaPortais['2'].x = mapa.x + mapa.largura - 30;
                listaPortais['2'].y = mapa.y + Math.floor(mapa.altura / 2) - 45;

                listaPortais['3'].x = mapa.x + Math.floor(mapa.largura / 2) - 45;
                listaPortais['3'].y = mapa.y;

                listaPortais['4'].x = mapa.x + Math.floor(mapa.largura / 2) - 45;
                listaPortais['4'].y = mapa.y + mapa.altura - 30;

                portais[n] = listaPortais[n];

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: portais[n].id,
                            class: 'po',
                        },
                        style: {
                            width: portais[n].largura + 'px',
                            height: portais[n].altura + 'px',
                            left: portais[n].x + 'px',
                            top: portais[n].y + 'px',
                        },
                    })
                );

                portais[n].func();
            }

            function criarMapa() {
                mapa = listaMapas[randint(0, 1)];

                mapa.id = 'mapa';

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: mapa.id,
                        },
                        style: {
                            width: mapa.largura + 'px',
                            height: mapa.altura + 'px',
                            left: mapa.x + 'px',
                            top: mapa.y + 'px',
                        },
                    })
                );

                mapa.func();
            }

            var listaItens = {
                vazio: {
                    nome: 'vazio',
                    texto: 'Vazio',
                    poder: 0,
                },
                0: {
                    nome: 'espada_ferro',
                    texto: 'Espada de Ferro',
                    poder: 40,
                    tipo: 'arma',
                    tipoAtaque: 'c',
                },
                1: {
                    nome: 'armadura_ferro',
                    texto: 'Armadura de Ferro',
                    poder: 40,
                    tipo: 'armadura',
                },
                2: {
                    nome: 'espada_ouro',
                    texto: 'Espada Dourada',
                    poder: 70,
                    tipo: 'arma',
                    tipoAtaque: 'c',
                },
                3: {
                    nome: 'armadura_trevas',
                    texto: 'Armadura das Trevas',
                    poder: 60,
                    tipo: 'armadura',
                },
                4: {
                    nome: 'pocao_hp',
                    texto: 'Poção de HP',
                    poder: 25,
                    tipo: 'cura',
                },
                5: {
                    nome: 'pocao_grande_hp',
                    texto: 'Poção Grande de HP',
                    poder: 50,
                    tipo: 'cura',
                },
                6: {
                    nome: 'arco_madeira',
                    texto: 'Arco de Madeira',
                    poder: 30,
                    tipo: 'arma',
                    tipoAtaque: 'd',
                },
            };

            var listaInimigos = {
                0: {
                    nome: 'guerreiro_esquecido',
                    altura: 40,
                    largura: 40,
                    hp: 200,
                    ataque: 10,
                    class: 'i',
                    equipamento: {
                        arma: {
                            nome: 'espada_simples',
                            texto: 'Espada Simples',
                            poder: 10,
                            tipoAtaque: 'c',
                        },
                        armadura: {
                            nome: 'armadura_simples',
                            texto: 'Armadura Simples',
                            poder: 10,
                        },
                    },
                },
                1: {
                    nome: 'zumbi',
                    altura: 40,
                    largura: 40,
                    hp: 200,
                    ataque: 10,
                    class: 'zumbi',
                    equipamento: {
                        arma: {
                            nome: 'espada_simples',
                            texto: 'Espada Simples',
                            poder: 10,
                            tipoAtaque: 'c',
                        },
                        armadura: {
                            nome: 'armadura_simples',
                            texto: 'Armadura Simples',
                            poder: 10,
                        },
                    },
                },
            };

            var inimigos = {};

            var obstaculos = {};

            var itens = {};

            var armas = {};

            // faz um objeto mudar de posição
            function andar(obj, direcao) {
                if (direcao == 'direita') {
                    if (obj.x + obj.largura < mapa.x + mapa.largura) {
                        obj.x++;
                        document.getElementById(obj.id).style.left = obj.x + 'px';
                    }
                } else if (direcao == 'esquerda') {
                    if (obj.x > mapa.x) {
                        obj.x--;
                        document.getElementById(obj.id).style.left = obj.x + 'px';
                    }
                } else if (direcao == 'cima') {
                    if (obj.y > mapa.y) {
                        obj.y--;
                        document.getElementById(obj.id).style.top = obj.y + 'px';
                    }
                } else if (direcao == 'baixo') {
                    if (obj.y + obj.altura < mapa.y + mapa.altura) {
                        obj.y++;
                        document.getElementById(obj.id).style.top = obj.y + 'px';
                    }
                }
            }

            function pontos(obj) {
                return {
                    a: {
                        x: obj.x,
                        y: obj.y,
                    },
                    b: {
                        x: obj.x,
                        y: obj.y + obj.altura,
                    },
                    c: {
                        x: obj.x + obj.largura,
                        y: obj.y,
                    },
                    d: {
                        x: obj.x + obj.largura,
                        y: obj.y + obj.altura,
                    },
                };
            }

            // valida o movimento de um objeto baseado na direção e colisão com outro objeto
            function movimento(obj1, obj2, direcao) {
                obj1.face = direcao;

                var pt1 = pontos(obj1);
                var pt2 = pontos(obj2);

                if (direcao == 'direita') {
                    if (pt1.c.x + 1 == pt2.b.x) {
                        if (pt1.c.y >= pt2.a.y && pt1.c.y <= pt2.b.y) {
                            return false;
                        } else if (pt1.d.y >= pt2.a.y && pt1.d.y <= pt2.b.y) {
                            return false;
                        } else if (pt1.c.y <= pt2.a.y && pt1.d.y >= pt2.b.y) {
                            return false;
                        }
                        
                        return true;
                    }
                    
                    return true;
                } else if (direcao == 'esquerda') {
                    if (pt1.b.x - 1 == pt2.c.x) {
                        if (pt1.b.y >= pt2.c.y && pt1.b.y <= pt2.d.y) {
                            return false;
                        } else if (pt1.a.y >= pt2.c.y && pt1.a.y <= pt2.d.y) {
                            return false;
                        } else if (pt1.a.y <= pt2.c.y && pt1.b.y >= pt2.d.y) {
                            return false;
                        }

                        return true;
                    }

                    return true;
                } else if (direcao == 'cima') {
                    if (pt1.a.y - 1 == pt2.b.y) {
                        if (pt1.c.x >= pt2.b.x && pt1.c.x <= pt2.d.x) {
                            return false;
                        } else if (pt1.a.x >= pt2.b.x && pt1.a.x <= pt2.d.x) {
                            return false;
                        } else if (pt1.a.x <= pt2.b.x && pt1.c.x >= pt2.d.x) {
                            return false;
                        } 

                        return true;
                    }
                        
                    return true;
                } else if (direcao == 'baixo') {
                    if (pt1.b.y + 1 == pt2.a.y) {
                        if (pt1.b.x >= pt2.a.x && pt1.b.x <= pt2.c.x) {
                            return false;
                        } else if (pt1.d.x >= pt2.a.x && pt1.d.x <= pt2.c.x) {
                            return false;
                        } else if (pt1.b.x <= pt2.a.x && pt1.d.x >= pt2.c.x) {
                            return false;
                        }
                        
                        return true;
                    }
                    
                    return true;
                }

                return false;
            }

            // verifica a interação de movimento e colisão entre todos os objetos (jogador, inimigos e obstáculos)
            function movimentoGeral(obj, direcao) {
                var e = true;

                for (const i in inimigos) {
                    if (obj.id != inimigos[i].id) {
                        if (!movimento(obj, inimigos[i], direcao)) {
                            e = false;
                        }
                    }
                }

                for (const i in obstaculos) {
                    if (obj.id != obstaculos[i].id) {
                        if (!movimento(obj, obstaculos[i], direcao)) {
                            e = false;
                        }
                    }
                }

                if (e) {
                    andar(obj, direcao);
                }
            }

            // verifica se houve colisao entre dois objetos ou se ocupam o mesmo lugar (é mais usado no ataque)
            function colisao(obj1, obj2) {
                var pt1 = pontos(obj1);
                var pt2 = pontos(obj2);

                return pt1.c.x + 1 >= pt2.b.x && pt1.b.x - 1 <= pt2.c.x && pt1.a.y - 1 <= pt2.b.y && pt1.b.y + 1 >= pt2.a.y;
            }

            function criarItem(n, x_i, y_i) {
                var w = Object.keys(itens).length + 1;

                obj = {
                    id: 'it' + w,
                    x: x_i,
                    y: y_i,
                    altura: 30,
                    largura: 30,
                    obj: listaItens[n],
                };

                itens['item' + w] = obj;

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: obj.id,
                            class: 'it',
                        },
                        style: {
                            width: obj.largura + 'px',
                            height: obj.altura + 'px',
                            left: obj.x + 'px',
                            top: obj.y + 'px',
                        },
                    })
                );
            }

            function mostrarEquipamento() {
                document.getElementById('status').innerHTML = '';

                document.getElementById('status').appendChild(
                    criarTag({
                        tipo: 'p',
                        innerHTML: 'Vida: ' + jogador.hp + '/' + jogador.hp_max,
                        style: {
                            fontSize: '20px',
                            color: 'white',
                            position: 'static',
                        },
                    })
                );

                document.getElementById('status').appendChild(
                    criarTag({
                        tipo: 'p',
                        innerHTML: 'Força: ' + jogador.ataque + ' (+' + jogador.equipamento.arma.poder + ')',
                        style: {
                            fontSize: '20px',
                            color: 'white',
                            position: 'static',
                        },
                    })
                );

                var divEquipamento = document.getElementById('div_equip_content');
                divEquipamento.innerHTML = '';

                for (const i in jogador.equipamento) {
                    if (jogador.equipamento[i].nome != 'vazio') {
                        var string = criarTag({
                            tipo: 'p',
                            innerHTML: jogador.equipamento[i].texto,
                            style: {
                                fontSize: '20px',
                                color: 'white',
                                position: 'static',
                            },
                        });

                        var b = criarTag({
                            tipo: 'button',
                            innerHTML: 'Remover',
                            style: {
                                backgroundColor: '#520a06',
                                border: '1px solid white',
                                width: '80px',
                                color: 'white',
                                height: '30px',
                            },
                            onclick: () => {
                                removerDoEquipamento(i);
                                mostrarEquipamento();
                            },
                        });

                        string.appendChild(b);

                        divEquipamento.appendChild(string);
                    }
                }
            }

            function mostrarInventario() {
                var d = document.getElementById('div_inv_content');
                d.innerHTML = '';

                for (const i in jogador.inventario) {
                    var string = criarTag({
                        tipo: 'p',
                        innerHTML: jogador.inventario[i].texto + ' (' + jogador.inventario[i].quantidade + 'x)',
                        style: {
                            fontSize: '20px',
                            color: 'white',
                            position: 'static',
                        },
                    });

                    if (jogador.inventario[i].tipo == 'cura') {
                        var b = criarTag({
                            tipo: 'button',
                            innerHTML: 'Usar',
                            style: {
                                backgroundColor: '#520a06',
                                border: '1px solid white',
                                width: '80px',
                                color: 'white',
                                height: '30px',
                            },
                            onclick: () => {
                                curar(jogador.inventario[i].nome);
                                mostrarInventario();
                            },
                        });

                        string.appendChild(b);
                    } else {
                        var b = criarTag({
                            tipo: 'button',
                            innerHTML: 'Ad Equip',
                            style: {
                                backgroundColor: '#520a06',
                                border: '1px solid white',
                                width: '80px',
                                color: 'white',
                                height: '30px',
                            },
                            onclick: () => {
                                adicionarAoEquipamento(jogador.inventario[i]);
                                mostrarInventario();
                            },
                        });

                        string.appendChild(b);
                    }

                    d.appendChild(string);
                }
            }

            function adicionarAoInventario(obj, p = undefined) {
                var item = {
                    nome: obj.nome,
                    texto: obj.texto,
                    poder: obj.poder,
                    tipo: obj.tipo,
                    quantidade: 1,
                };

                if (typeof obj.tipoAtaque != 'undefined') {
                    item.tipoAtaque = obj.tipoAtaque;
                }

                if (typeof jogador.inventario[item.nome] != 'undefined') {
                    jogador.inventario[item.nome].quantidade += item.quantidade;
                } else {
                    jogador.inventario[item.nome] = item;
                }

                if (typeof p != 'undefined') {
                    document.getElementById(itens[p].id).remove();

                    delete itens[p];
                }
            }

            function removerDoEquipamento(t) {
                if (typeof jogador.equipamento[t] != 'undefined') {
                    if (jogador.equipamento[t].nome != 'vazio') {
                        jogador.equipamento[t].tipo = t;

                        adicionarAoInventario(jogador.equipamento[t]);
                    }

                    jogador.equipamento[t] = listaItens['vazio'];
                }
            }

            function adicionarAoEquipamento(obj) {
                var item = {
                    nome: obj.nome,
                    texto: obj.texto,
                    poder: obj.poder,
                };

                if (typeof obj.tipoAtaque != 'undefined') {
                    item.tipoAtaque = obj.tipoAtaque;
                }

                removerDoEquipamento(obj.tipo);

                jogador.equipamento[obj.tipo] = item;

                if (obj.quantidade > 1) {
                    jogador.inventario[obj.nome].quantidade--;
                } else {
                    delete jogador.inventario[obj.nome];
                }
            }

            var contador_arma = 0;

            function criarArma(atacante, o_larg, o_alt) {
                var w = contador_arma + 1;
                contador_arma++;

                var obj = {
                    id: 'ar' + w,
                };

                if (atacante.face == 'esquerda') {
                    obj.largura = o_larg;
                    obj.altura = o_alt;
                    obj.x = atacante.x - obj.largura;
                    obj.y = Math.round(atacante.y + atacante.altura / 2 - obj.altura / 2);
                } else if (atacante.face == 'direita') {
                    obj.largura = o_larg;
                    obj.altura = o_alt;
                    obj.x = atacante.x + atacante.largura;
                    obj.y = Math.round(atacante.y + atacante.altura / 2 - obj.altura / 2);
                } else if (atacante.face == 'cima') {
                    obj.largura = o_alt;
                    obj.altura = o_larg;
                    obj.x = Math.round(atacante.x + atacante.largura / 2 - obj.largura / 2);
                    obj.y = atacante.y - obj.altura;
                } else if (atacante.face == 'baixo') {
                    obj.largura = o_alt;
                    obj.altura = o_larg;
                    obj.x = Math.round(atacante.x + atacante.largura / 2 - obj.largura / 2);
                    obj.y = atacante.y + atacante.altura;
                }

                armas['arma' + w] = obj;

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: obj.id,
                            class: 'ar',
                        },
                        style: {
                            width: obj.largura + 'px',
                            height: obj.altura + 'px',
                            left: obj.x + 'px',
                            top: obj.y + 'px',
                        },
                    })
                );

                return 'arma' + w;
            }

            function atacar(obj) {
                var arma_id = criarArma(obj, 25, 6);
                var ar = document.getElementById(armas[arma_id].id);

                //

                if (obj.equipamento.arma.tipoAtaque == 'd') {
                    var projetil_id = criarArma(obj, 25, 6);
                    var pr = document.getElementById(armas[projetil_id].id);
                    var face = obj.face;
                    var pos = {
                        x: armas[projetil_id].x,
                        y: armas[projetil_id].y,
                    };

                    armas[projetil_id].mov = setInterval(() => {
                        andar(armas[projetil_id], face);

                        for (const i in inimigos) {
                            if (colisao(armas[projetil_id], inimigos[i])) {
                                inimigos[i].hp = Math.round(
                                    inimigos[i].hp - (jogador.ataque + jogador.equipamento.arma.poder - (inimigos[i].equipamento.armadura.poder / 100) * (jogador.ataque + jogador.equipamento.arma.poder))
                                );

                                if (inimigos[i].hp <= 0) {
                                    criarItem(randint(0, 6), inimigos[i].x, inimigos[i].y);
                                    //criarItem(3);

                                    clearInterval(inimigos[i].mov);

                                    document.getElementById(inimigos[i].id).remove();

                                    delete inimigos[i];
                                }

                                clearInterval(armas[projetil_id].mov);
                                pr.remove();
                                delete armas[projetil_id];
                            }
                        }
                    }, 0.5);

                    setTimeout(() => {
                        if (armas[projetil_id]) {
                            clearInterval(armas[projetil_id].mov);
                            pr.remove();
                            delete armas[projetil_id];
                        }
                    }, 1500);
                }

                //

                if (obj.id != jogador.id) {
                    if (colisao(armas[arma_id], obj)) {
                        jogador.hp = Math.round(jogador.hp - (obj.ataque + obj.equipamento.arma.poder - (jogador.equipamento.armadura.poder / 100) * (obj.ataque + obj.equipamento.arma.poder)));

                        if (jogador.hp <= 0) {
                            delete armas[arma_id];
                            ar.remove();
                            reset();

                            for (const i in jogador.mov) {
                                clearInterval(jogador.mov[i]);
                            }
                            jogador = {};

                            alert('Você morreu.');

                            document.getElementById('inicial').style.display = 'block';
                        } else {
                            document.getElementById('p_hp').setAttribute('value', jogador.hp);
                        }
                    }

                    obj.pa = false;

                    setTimeout(() => {
                        delete armas[arma_id];
                        ar.remove();

                        setTimeout(() => {
                            obj.pa = true;
                        }, 300);
                    }, 40);
                } else {
                    setTimeout(() => {
                        delete armas[arma_id];
                        ar.remove();
                    }, 40);

                    for (const i in inimigos) {
                        if (colisao(armas[arma_id], inimigos[i])) {
                            inimigos[i].hp = Math.round(
                                inimigos[i].hp - (jogador.ataque + jogador.equipamento.arma.poder - (inimigos[i].equipamento.armadura.poder / 100) * (jogador.ataque + jogador.equipamento.arma.poder))
                            );

                            if (inimigos[i].hp <= 0) {
                                criarItem(randint(0, 6), inimigos[i].x, inimigos[i].y);
                                //criarItem(3);

                                clearInterval(inimigos[i].mov);

                                document.getElementById(inimigos[i].id).remove();

                                delete inimigos[i];
                            }
                        }
                    }
                }
            }

            // inteligência artificial básica para os inimigos
            function ia(obj) {
                if (jogador.x + jogador.largura < obj.x - 100 || jogador.x > obj.x + obj.largura + 100 || jogador.y + jogador.altura < obj.y - 100 || jogador.y > obj.y + obj.altura + 100) {
                    if (obj.x < obj.inix + 20 && obj.bool == true) {
                        obj.bool = true;

                        movimentoGeral(obj, 'direita');
                    } else {
                        obj.bool = false;
                    }

                    if (obj.x > obj.inix - 20 && obj.bool == false) {
                        obj.bool = false;

                        movimentoGeral(obj, 'esquerda');
                    } else {
                        obj.bool = true;
                    }
                } else {
                    if (jogador.x < obj.x) {
                        if (movimento(obj, jogador, 'esquerda')) {
                            movimentoGeral(obj, 'esquerda');
                        } else {
                            if (obj.pa) {
                                atacar(obj);
                            }
                        }
                    } else if (jogador.x == obj.x) {
                    } else {
                        if (movimento(obj, jogador, 'direita')) {
                            movimentoGeral(obj, 'direita');
                        } else {
                            if (obj.pa) {
                                atacar(obj);
                            }
                        }
                    }

                    if (jogador.y < obj.y) {
                        if (movimento(obj, jogador, 'cima')) {
                            movimentoGeral(obj, 'cima');
                        } else {
                            if (obj.pa) {
                                atacar(obj);
                            }
                        }
                    } else if (jogador.y == obj.y) {
                    } else {
                        if (movimento(obj, jogador, 'baixo')) {
                            movimentoGeral(obj, 'baixo');
                        } else {
                            if (obj.pa) {
                                atacar(obj);
                            }
                        }
                    }
                }
            }

            // cria os inimigos e coloca no mapa
            function criarInimigo() {
                var w = Object.keys(inimigos).length + 1;

                var ini = listaInimigos[randint(0, 1)];

                var obj = {
                    id: 'i' + w,
                    bool: true,
                    pa: true,
                    face: 'direita',
                    altura: ini.altura,
                    largura: ini.largura,
                    hp: ini.hp,
                    ataque: ini.ataque,
                    class: ini.class,
                    equipamento: {
                        arma: {
                            nome: ini.equipamento.arma.nome,
                            texto: ini.equipamento.arma.texto,
                            poder: ini.equipamento.arma.poder,
                        },
                        armadura: {
                            nome: ini.equipamento.armadura.nome,
                            texto: ini.equipamento.armadura.texto,
                            poder: ini.equipamento.armadura.poder,
                            tipoAtaque: ini.equipamento.armadura.tipoAtaque,
                        },
                    },
                };

                let bool = {
                    o: true,
                    i: true,
                };

                do {
                    bool.o = true;
                    bool.i = true;

                    obj.x = obj.inix = randint(mapa.x + 130, mapa.x + mapa.largura - 230);
                    obj.y = obj.iniy = randint(mapa.y + 130, mapa.y + mapa.altura - 230);

                    for (const i in inimigos) {
                        if (colisao(inimigos[i], obj)) {
                            bool.i = false;
                            break;
                        }
                    }

                    for (const i in obstaculos) {
                        if (colisao(obstaculos[i], obj)) {
                            bool.o = false;
                            break;
                        }
                    }
                } while (bool.i == false || bool.o == false);

                inimigos['inimigo' + w] = obj;

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: obj.id,
                            class: obj.class,
                        },
                        style: {
                            width: obj.largura + 'px',
                            height: obj.altura + 'px',
                            left: obj.x + 'px',
                            top: obj.y + 'px',
                        },
                    })
                );

                inimigos['inimigo' + w].mov = setInterval(() => {
                    ia(inimigos['inimigo' + w]);
                }, 25);
            }

            // cria obstaculos e coloca no mapa
            function criarObstaculo(x, y, largura, altura) {
                var w = Object.keys(obstaculos).length + 1;

                var obj = {
                    id: 'o' + w,
                    x: x,
                    y: y,
                    altura: altura,
                    largura: largura,
                };

                obstaculos['obstaculo' + w] = obj;

                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: obj.id,
                            class: 'o',
                        },
                        style: {
                            width: obj.largura + 'px',
                            height: obj.altura + 'px',
                            left: obj.x + 'px',
                            top: obj.y + 'px',
                        },
                    })
                );
            }

            function criarJogador() {
                c.appendChild(
                    criarTag({
                        tipo: 'div',
                        attributes: {
                            id: jogador.id,
                        },
                        style: {
                            width: jogador.largura + 'px',
                            height: jogador.altura + 'px',
                            left: jogador.x + 'px',
                            top: jogador.y + 'px',
                        },
                    })
                );

                c.appendChild(
                    criarTag({
                        tipo: 'progress',
                        attributes: {
                            id: 'p_hp',
                            value: jogador.hp,
                            max: jogador.hp_max,
                        },
                        style: {
                            width: '200px',
                            height: '30px',
                            left: mapa.x + 'px',
                            top: '70px',
                            backgroundColor: 'green',
                        },
                    })
                );
            }

            function reset() {
                document.getElementById(jogador.id).remove();
                document.getElementById('p_hp').remove();

                document.getElementById(mapa.id).remove();
                mapa = {};

                for (const j in obstaculos) {
                    document.getElementById(obstaculos[j].id).remove();
                    delete obstaculos[j];
                }

                for (const j in inimigos) {
                    document.getElementById(inimigos[j].id).remove();
                    clearInterval(inimigos[j].mov);
                    delete inimigos[j];
                }

                for (const j in portais) {
                    document.getElementById(portais[j].id).remove();
                    delete portais[j];
                }

                for (const j in itens) {
                    document.getElementById(itens[j].id).remove();
                    delete itens[j];
                }

                for (const j in armas) {
                    document.getElementById(armas[j].id).remove();
                    clearInterval(armas[j].mov);
                    delete armas[j];
                }
            }

            function entrouPortal() {
                for (const i in portais) {
                    if (colisao(jogador, portais[i])) {
                        reset();

                        criarMapa();

                        if (i == '1') {
                            criarPortais(2);

                            if (perc(50)) {
                                criarPortais(1);
                            }

                            if (perc(50)) {
                                criarPortais(3);
                            }

                            if (perc(50)) {
                                criarPortais(4);
                            }

                            jogador.x = Math.round(mapa.x + mapa.largura - portais['2'].largura - jogador.largura * 2);
                            jogador.y = Math.round(mapa.y + mapa.altura / 2 - jogador.altura / 2);
                        } else if (i == '2') {
                            criarPortais(1);

                            if (perc(50)) {
                                criarPortais(2);
                            }

                            if (perc(50)) {
                                criarPortais(3);
                            }

                            if (perc(50)) {
                                criarPortais(4);
                            }

                            jogador.x = Math.round(mapa.x + portais['1'].largura + jogador.largura);
                            jogador.y = Math.round(mapa.y + mapa.altura / 2 - jogador.altura / 2);
                        } else if (i == '3') {
                            criarPortais(4);

                            if (perc(50)) {
                                criarPortais(1);
                            }

                            if (perc(50)) {
                                criarPortais(2);
                            }

                            if (perc(50)) {
                                criarPortais(3);
                            }

                            jogador.x = Math.round(mapa.x + mapa.largura / 2 - jogador.largura / 2);
                            jogador.y = Math.round(mapa.y + mapa.altura - portais['4'].altura - jogador.altura * 2);
                        } else if (i == '4') {
                            criarPortais(3);

                            if (perc(50)) {
                                criarPortais(1);
                            }

                            if (perc(50)) {
                                criarPortais(2);
                            }

                            if (perc(50)) {
                                criarPortais(4);
                            }

                            jogador.x = Math.round(mapa.x + mapa.largura / 2 - jogador.largura / 2);
                            jogador.y = Math.round(mapa.y + portais['3'].altura + jogador.altura);
                        }

                        criarJogador();

                        for (k = randint(1, 3); k > 0; k--) {
                            criarInimigo();
                        }

                        break;
                    }
                }
            }

            function pegarItem() {
                for (const i in itens) {
                    if (colisao(jogador, itens[i])) {
                        adicionarAoInventario(itens[i].obj, i);
                    }
                }
            }

            function curar(pocao_nome) {
                if (jogador.hp + (jogador.hp_max * jogador.inventario[pocao_nome].poder) / 100 <= jogador.hp_max) {
                    jogador.hp = jogador.hp + (jogador.hp_max * jogador.inventario[pocao_nome].poder) / 100;
                } else {
                    jogador.hp = jogador.hp_max;
                }

                if (jogador.inventario[pocao_nome].quantidade == 1) {
                    delete jogador.inventario[pocao_nome];
                } else {
                    jogador.inventario[pocao_nome].quantidade--;
                }

                document.getElementById('p_hp').setAttribute('value', jogador.hp);
            }

            var jogador;

            function iniciar() {
                criarMapa();

                criarPortais(3);

                criarInimigo();

                jogador = {
                    id: 'p',
                    altura: 40,
                    largura: 40,
                    x: Math.round(mapa.x + mapa.largura / 2 - 20),
                    y: Math.round(mapa.y + mapa.altura - 125),
                    face: 'cima',
                    hp: 200,
                    hp_max: 200,
                    ataque: 50,
                    inventario: {},
                    equipamento: {
                        arma: {
                            nome: 'espada_madeira',
                            texto: 'Espada de Madeira',
                            poder: 5,
                            tipoAtaque: 'c',
                        },
                        armadura: listaItens['vazio'],
                    },
                    mov: {
                        direita: false,
                        esquerda: false,
                        cima: false,
                        baixo: false,
                    },
                };

                criarJogador();

                adicionarAoInventario(listaItens[6]);
            }

            document.getElementById('novo').onclick = function () {
                document.getElementById('inicial').style.display = 'none';
                iniciar();
            };

            // controles do jogador
            document.addEventListener('keydown', function (event) {
                if (event.keyCode == 37) {
                    clearInterval(jogador.mov.esquerda);

                    jogador.mov.esquerda = setInterval(() => {
                        entrouPortal();

                        pegarItem();

                        movimentoGeral(jogador, 'esquerda');
                    }, 5);
                } else if (event.keyCode == 39) {
                    clearInterval(jogador.mov.direita);

                    jogador.mov.direita = setInterval(() => {
                        entrouPortal();

                        pegarItem();

                        movimentoGeral(jogador, 'direita');
                    }, 5);
                }

                if (event.keyCode == 38) {
                    clearInterval(jogador.mov.cima);

                    jogador.mov.cima = setInterval(() => {
                        entrouPortal();

                        pegarItem();

                        movimentoGeral(jogador, 'cima');
                    }, 5);
                } else if (event.keyCode == 40) {
                    clearInterval(jogador.mov.baixo);

                    jogador.mov.baixo = setInterval(() => {
                        entrouPortal();

                        pegarItem();

                        movimentoGeral(jogador, 'baixo');
                    }, 5);
                }

                if (event.keyCode == 32) {
                    atacar(jogador);
                }

                if (event.keyCode == 73) {
                    var div = document.getElementById('div_inv');

                    if (div.style.display == 'none' || div.style.display == '') {
                        mostrarInventario();

                        div.style.display = 'block';
                    } else {
                        div.style.display = 'none';
                    }
                }

                if (event.keyCode == 69) {
                    var div = document.getElementById('div_equip');

                    if (div.style.display == 'none' || div.style.display == '') {
                        mostrarEquipamento();

                        div.style.display = 'block';
                    } else {
                        div.style.display = 'none';
                    }
                }
            });

            document.addEventListener('keyup', function (event) {
                if (event.keyCode == 37) {
                    clearInterval(jogador.mov.esquerda);
                } else if (event.keyCode == 39) {
                    clearInterval(jogador.mov.direita);
                }

                if (event.keyCode == 38) {
                    clearInterval(jogador.mov.cima);
                } else if (event.keyCode == 40) {
                    clearInterval(jogador.mov.baixo);
                }
            });
        </script>
    </body>
</html>
